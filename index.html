<script>
  async function downloadShort() {
    const url = document.getElementById("videoUrl").value;
    const result = document.getElementById("result");
    const error = document.getElementById("error");
    result.innerHTML = '';
    error.textContent = '';

    console.log("Download function triggered");

    if (!url.includes("youtube.com/shorts")) {
      error.textContent = "Please enter a valid YouTube Shorts URL.";
      return;
    }

    try {
      const response = await fetch('/api/download', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });

      console.log("Response received:", response);

      const data = await response.json();
      if (data.downloadUrl) {
        result.innerHTML = `<p>Video ready:</p><a href="${data.downloadUrl}" target="_blank">Click to Download</a>`;
      } else {
        error.textContent = data.error || "Failed to retrieve video.";
      }
    } catch (err) {
      console.error("Download error:", err);
      error.textContent = "Something went wrong. Try again.";
    }
  }
</script>
